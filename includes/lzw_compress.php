<?php

/**
 * @link http://code.google.com/p/php-lzw/
 * @author Jakub Vrana, http://www.vrana.cz/
 * @copyright 2009 Jakub Vrana
 * @license http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0
 */

/** LZW compression
 * @param string data to compress
 * @return string binary data
 */
function lzw_compress($string)
{
    // compression
    $dictionary = array_flip(range("\0", "\xFF"));
    $word = "";
    $codes = array();
    for ($i = 0; $i <= strlen($string); $i++) {
        $x = substr($string, $i, 1);
        if (strlen($x) && isset($dictionary[$word . $x])) {
            $word .= $x;
        } elseif ($i) {
            $codes[] = $dictionary[$word];
            $dictionary[$word . $x] = count($dictionary);
            $word = $x;
        }
    }

    // convert codes to binary string
    $dictionary_count = 256;
    $bits = 8; // ceil(log($dictionary_count, 2))
    $return = "";
    $rest = 0;
    $rest_length = 0;
    foreach ($codes as $code) {
        $rest = ($rest << $bits) + $code;
        $rest_length += $bits;
        $dictionary_count++;
        if ($dictionary_count >> $bits) {
            $bits++;
        }
        while ($rest_length > 7) {
            $rest_length -= 8;
            $return .= chr($rest >> $rest_length);
            $rest &= (1 << $rest_length) - 1;
        }
    }
    return $return . ($rest_length ? chr($rest << (8 - $rest_length)) : "");
}

/** LZW decompression
 * @param string compressed binary data
 * @return string original data
 */
function lzw_decompress($binary)
{
    // convert binary string to codes
    $dictionary_count = 256;
    $bits = 8; // ceil(log($dictionary_count, 2))
    $codes = array();
    $rest = 0;
    $rest_length = 0;
    for ($i = 0; $i < strlen($binary); $i++) {
        $rest = ($rest << 8) + ord($binary[$i]);
        $rest_length += 8;
        if ($rest_length >= $bits) {
            $rest_length -= $bits;
            $codes[] = $rest >> $rest_length;
            $rest &= (1 << $rest_length) - 1;
            $dictionary_count++;
            if ($dictionary_count >> $bits) {
                $bits++;
            }
        }
    }

    // decompression
    $dictionary = range("\0", "\xFF");
    $return = "";
    foreach ($codes as $i => $code) {
        $element = $dictionary[$code];
        if (!isset($element)) {
            $element = $word . $word[0];
        }
        $return .= $element;
        if ($i) {
            $dictionary[] = $word . $element[0];
        }
        $word = $element;
    }
    return $return;
}

function str_fromcharcode()
{
    return implode(array_map('chr', func_get_args()));
}


function samadhan_decompress($compressed)
{

    $dictionary = [];
    //$entry = '';
    $dictSize = 256;
    for ($i = 0; $i < 256; $i++) {
        $dictionary[$i] = chr($i);
    }
    $w = str_fromcharcode($compressed[0]);
    $result = $w;


    for ($i = 1; $i < sizeof($compressed); $i++) {
        $k = $compressed[$i];
        if (!empty($dictionary[$k])) {
            $entry = $dictionary[$k];
        } else {
            if ($k === $dictSize) {
                $entry = $w . $w[0];
            } else {
                //return null;
                $entry = 0;
            }
        }
        $result .= $entry;

            $dictionary[$dictSize++] = $w .$entry[0];


        $w = $entry;
    }
    return $result;

}

;

//{"lessons":{""":{"c":1,"p":1":1":1,"i":{""":{"c":1,"i":{""":{"vp":":1,"c":1}}},"1":{"c":1,"i":{""":{"c":1}}}}},"2":{"c":1,"p":1":1","i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"c":1}}},"2":{"c":1,"i":{""":{"vp":","c":1}}},"3":{"c":1,"i":{""":{"c":1}}},"4":{"c":1,"i":{""":{"c":1}}},"5":{"c":1,"i":{""":{"c":1}}},"6":{"c":1,"i":{""":{"c":1}}},"7":{"c":1,"i":{""":{"c":1}}},"8":{"c":1,"i":{""":{"c":1}}},"9":{"c":1,"i":{""":{"c":1}}},"1"":{"c":1,"i":{""":{"c":1}}},"11":{"c":1,"i":{""":{"c":1}}},"12":{"c":1,"i":{""":{"c":1}}},"13":{"c":1,"i":{""":{"c":1}}},"14":{"c":1,"i":{""":{"c":1}}},"15":{"c":1,"i":{""":{"c":1}}},"16":{"c":1,"i":{""":{"c":1}}}}},"3":{"c":1,"p":1":1","i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"c":1}}},"2":{"c":1,"i":{""":{"c":1},"1":{"c":1}}}}},"5":{"c":1,"p":1":1","i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"vp":":1,"c":1}}},"2":{"c":1,"i":{""":{"c":1}}},"3":{"c":1,"i":{""":{"c":1},"1":{"c":1},"2":{"c":1}}},"4":{"c":1,"i":{""":{"c":1}}},"5":{"c":1,"i":{""":{"c":1},"1":{"c":1},"2":{"c":1},"3":{"c":1},"4":{"c":1},"5":{"c":1},"6":{"c":1},"7":{"c":1}}},"6":{"c":1,"i":{""":{"c":1}}},"7":{"c":1,"i":{""":{"c":1}}}}},"7":{"c":1,"p":1"":1,"i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"c":1}}},"2":{"c":1,"i":{""":{"c":1},"1":{"c":1}}},"3":{"c":1,"i":{""":{"c":1}}},"4":{"c":1,"i":{""":{"c":1}}},"5":{"c":1,"i":{""":{"c":1}}},"6":{"c":1,"i":{""":{"c":1}}},"7":{"c":1,"i":{""":{"vp":":1,"c":1}}}}},"9":{"c":1,"p":1"":1,"i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"vp":","c":1}}},"2":{"c":1,"i":{""":{"c":1}}},"3":{"c":1,"i":{""":{"c":1}}},"4":{"c":1,"i":{""":{"c":1}}},"5":{"c":1,"i":{""":{"c":1}}},"6":{"c":1,"i":{""":{"c":1}}},"7":{"c":1,"i":{""":{"c":1},"1":{"c":1},"2":{"c":1}}},"8":{"c":1,"i":{""":{"c":1}}}}},"1"":{"c":1,"p":1"","i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"vp":":1,"c":1}}},"2":{"c":1,"i":{""":{"c":1}}},"3":{"c":1,"i":{""":{"c":1},"1":{"c":1},"2":{"c":1}}},"4":{"c":1,"i":{""":{"c":1}}},"5":{"c":1,"i":{""":{"c":1},"1":{"c":1},"2":{"c":1},"3":{"c":1}}},"6":{"c":1,"i":{""":{"c":1}}},"7":{"c":1,"i":{""":{"c":1}}},"8":{"c":1,"i":{""":{"c":1}}}}},"11":{"p":17,"i":{""":{"c":1,"i":{""":{"c":1}}},"1":{"c":1,"i":{""":{"c":1}}},"2":{"c":1,"i":{""":{"c":1}}},"3":{"i":{}},"4":{"i":{}},"5":{"i":{}},"6":{"i":{}},"7":{"i":{}},"8":{"i":{}},"9":{"i":{}},"1"":{"i":{}},"11":{"i":{}},"12":{"i":{}},"13":{"i":{}},"14":{"i":{}},"15":{"i":{}},"16":{"i":{}},"17":{"i":{}}}}},"p":29}}"
//{"lessons":{"0":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"vp":0,"c":1}}},"1":{"c":1,"i":{"0":{"c":1}}}}},"2":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"c":1}}},"2":{"c":1,"i":{"0":{"vp":0,"c":1}}},"3":{"c":1,"i":{"0":{"c":1}}},"4":{"c":1,"i":{"0":{"c":1}}},"5":{"c":1,"i":{"0":{"c":1}}},"6":{"c":1,"i":{"0":{"c":1}}},"7":{"c":1,"i":{"0":{"c":1}}},"8":{"c":1,"i":{"0":{"c":1}}},"9":{"c":1,"i":{"0":{"c":1}}},"10":{"c":1,"i":{"0":{"c":1}}},"11":{"c":1,"i":{"0":{"c":1}}},"12":{"c":1,"i":{"0":{"c":1}}},"13":{"c":1,"i":{"0":{"c":1}}},"14":{"c":1,"i":{"0":{"c":1}}},"15":{"c":1,"i":{"0":{"c":1}}},"16":{"c":1,"i":{"0":{"c":1}}}}},"3":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"c":1}}},"2":{"c":1,"i":{"0":{"c":1},"1":{"c":1}}}}},"5":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"vp":0,"c":1}}},"2":{"c":1,"i":{"0":{"c":1}}},"3":{"c":1,"i":{"0":{"c":1},"1":{"c":1},"2":{"c":1}}},"4":{"c":1,"i":{"0":{"c":1}}},"5":{"c":1,"i":{"0":{"c":1},"1":{"c":1},"2":{"c":1},"3":{"c":1},"4":{"c":1},"5":{"c":1},"6":{"c":1},"7":{"c":1}}},"6":{"c":1,"i":{"0":{"c":1}}},"7":{"c":1,"i":{"0":{"c":1}}}}},"7":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"c":1}}},"2":{"c":1,"i":{"0":{"c":1},"1":{"c":1}}},"3":{"c":1,"i":{"0":{"c":1}}},"4":{"c":1,"i":{"0":{"c":1}}},"5":{"c":1,"i":{"0":{"c":1}}},"6":{"c":1,"i":{"0":{"c":1}}},"7":{"c":1,"i":{"0":{"vp":0,"c":1}}}}},"9":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"vp":0,"c":1}}},"2":{"c":1,"i":{"0":{"c":1}}},"3":{"c":1,"i":{"0":{"c":1}}},"4":{"c":1,"i":{"0":{"c":1}}},"5":{"c":1,"i":{"0":{"c":1}}},"6":{"c":1,"i":{"0":{"c":1}}},"7":{"c":1,"i":{"0":{"c":1},"1":{"c":1},"2":{"c":1}}},"8":{"c":1,"i":{"0":{"c":1}}}}},"10":{"c":1,"p":100,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"vp":0,"c":1}}},"2":{"c":1,"i":{"0":{"c":1}}},"3":{"c":1,"i":{"0":{"c":1},"1":{"c":1},"2":{"c":1}}},"4":{"c":1,"i":{"0":{"c":1}}},"5":{"c":1,"i":{"0":{"c":1},"1":{"c":1},"2":{"c":1},"3":{"c":1}}},"6":{"c":1,"i":{"0":{"c":1}}},"7":{"c":1,"i":{"0":{"c":1}}},"8":{"c":1,"i":{"0":{"c":1}}}}},"11":{"p":83,"i":{"0":{"c":1,"i":{"0":{"c":1}}},"1":{"c":1,"i":{"0":{"c":1}}},"2":{"c":1,"i":{"0":{"c":1}}},"3":{"c":1,"i":{"0":{"c":1},"1":{"c":1},"2":{"c":1}}},"4":{"c":1,"i":{"0":{"c":1}}},"5":{"c":1,"i":{"0":{"c":1}}},"6":{"c":1,"i":{"0":{"c":1}}},"7":{"c":1,"i":{"0":{"c":1}}},"8":{"c":1,"i":{"0":{"c":1}}},"9":{"c":1,"i":{"0":{"c":1}}},"10":{"c":1,"i":{"0":{"c":1}}},"11":{"c":1,"i":{"0":{"c":1}}},"12":{"c":1,"i":{"0":{"c":1}}},"13":{"c":1,"i":{"0":{"c":1}}},"14":{"c":1,"i":{"0":{"c":1}}},"15":{"i":{}},"16":{"i":{}},"17":{"i":{}}}}},"p":29}
